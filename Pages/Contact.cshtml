@page
@model ITWebsite.Pages.ContactModel
@{
  ViewData["Title"] = "Contact Us";
}

<section class="py-5">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-6">
        <h1 class="fw-bold section-title mb-2">Contact</h1>
        <p class="text-secondary mb-4">
          Tell me what’s going on and what you’re trying to accomplish. I’ll reply with next steps
          (remote, in-home, or a full system restore) and a clear estimate.
        </p>

        <div class="d-flex gap-3 mb-3">
          <div class="icon-badge"><i class="bi bi-clock fs-5"></i></div>
          <div>
            <div class="fw-semibold">Availability</div>
            <div class="text-secondary">Typically evenings & weekends</div>
          </div>
        </div>

        <div class="d-flex gap-3 mb-3">
          <div class="icon-badge"><i class="bi bi-geo-alt fs-5"></i></div>
          <div>
            <div class="fw-semibold">Service area</div>
            <div class="text-secondary">Remote + on-site anywhere in Calgary</div>
          </div>
        </div>

        <div class="d-flex gap-3">
          <div class="icon-badge"><i class="bi bi-shield-check fs-5"></i></div>
          <div>
            <div class="fw-semibold">What to expect</div>
            <div class="text-secondary">Clear communication, honest pricing, and a short initial triage to recommend next steps.</div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card hover-lift">
          <div class="card-body p-4">
            <h4 class="fw-semibold mb-3">Let's get connected</h4>

            <form method="post" asp-antiforgery="true">

              <input type="hidden" asp-for="FormTimeToken" />

              <!-- Honeypot: real users never see/fill this -->
              <div class="d-none">
                <label>Website</label>
                <input class="form-control" name="Website" autocomplete="off" tabindex="-1" />
              </div>

              <div class="row g-3">

                <div class="col-md-6">
                  <label class="form-label required" asp-for="Name">Name</label>
                  <input class="form-control" asp-for="Name" id="nameInput" placeholder="Your name" />
                  <span class="text-danger" asp-validation-for="Name"></span>
                </div>

                <div class="col-md-6" id="emailField">
                  <label class="form-label required" asp-for="Email">Email</label>
                  <input class="form-control" asp-for="Email" id="emailInput" placeholder="example@email.com" />
                  <span class="text-danger" asp-validation-for="Email"></span>
                </div>

                <div class="col-12 d-none" id="phoneField">
                  <label class="form-label required" asp-for="PhoneNumber">Phone Number</label>
                  <input class="form-control" asp-for="PhoneNumber" id="phoneInput" placeholder="(403) 123-4567" />
                  <span class="text-danger" asp-validation-for="PhoneNumber"></span>
                </div>

                <div class="col-12">
                  <label class="form-label required" asp-for="ServiceType">What do you need help with?</label>
                  <select class="form-select" asp-for="ServiceType" id="serviceType">
                    <option value="" disabled selected="@string.IsNullOrWhiteSpace(Model.ServiceType)">Choose a service...</option>
                    <option value="General support">General support (printer, email, troubleshooting)</option>
                    <option value="Wi-Fi & networking">Wi-Fi & networking</option>
                    <option value="New device setup">New device setup</option>
                    <option value="System restore">Complete system restore & optimization</option>
                    <option value="Backup & storage">Backup & storage</option>
                    <option value="NAS project">Private home storage (NAS) project</option>
                    <option value="PC build">Custom PC build guidance</option>
                    <option value="Not sure">Not sure, please recommend</option>
                  </select>
                  <span class="text-danger" asp-validation-for="ServiceType"></span>
                </div>

                <div class="col-12">
                  <label class="form-label required" asp-for="Message">What’s happening?</label>
                  <textarea class="form-control" asp-for="Message" id="messageInput" rows="6"
                    placeholder="Example: ‘My laptop is very slow and keeps freezing. I mainly use it for school. I’m worried about losing my files. I’d like it stable again.’"></textarea>
                  <span class="text-danger" asp-validation-for="Message"></span>
                </div>

                <div class="col-12">
                  <label class="form-label" asp-for="DeviceType">Device type</label>
                  <select class="form-select" asp-for="DeviceType">
                    <option value="" disabled selected="@string.IsNullOrWhiteSpace(Model.DeviceType)">Choose a device type…</option>
                    <option value="Windows laptop/desktop">Windows laptop/desktop</option>
                    <option value="Mac">Mac</option>
                    <option value="Phone/tablet">Phone/tablet</option>
                    <option value="Wi-Fi / network">Wi-Fi / network</option>
                    <option value="Other">Other</option>
                  </select>
                </div>

                <div class="col-12">
                  <label class="form-label" asp-for="ServiceMode">Where would you like help?</label>
                  <select class="form-select" asp-for="ServiceMode">
                    <option value="Not sure">Not sure</option>
                    <option value="Remote">Remote (if possible)</option>
                    <option value="In-home">In-home (Calgary)</option>
                  </select>
                </div>

                <div class="col-12">
                  <label class="form-label required" asp-for="ContactMethod">Preferred contact method</label>
                  <select class="form-select" asp-for="ContactMethod" id="contactMethod">
                    <option value="Email">Email</option>
                    <option value="Phone call">Phone call</option>
                    <option value="Text">Text</option>
                    <option value="Any">Any</option>
                  </select>
                  <span class="text-danger" asp-validation-for="ContactMethod"></span>
                </div>

                <div class="form-check mt-3">
                  <input class="form-check-input" type="checkbox" asp-for="PrivacyConsent" />
                  <label class="form-check-label small text-secondary required" asp-for="PrivacyConsent">
                    I have read and agree to the <a asp-page="/Privacy">Privacy Policy</a>.
                  </label>
                </div>
                <span asp-validation-for="PrivacyConsent" class="text-danger small"></span>

                <div class="col-12 d-grid">
                  <button type="submit" id="submitBtn" class="btn btn-primary btn-lg">
                    <span id="btnText">Submit</span>
                    <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
                  </button>
                </div>

                @if (!string.IsNullOrWhiteSpace(Model.ErrorMessage))
                {
                  <div class="alert alert-danger mt-3">@Model.ErrorMessage</div>
                }

                @* <div asp-validation-summary="All" class="text-danger"></div> *@

                @if (Model.Sent)
                {
                  <div class="alert alert-success mt-3">
                    Your request has been sent. We’ll be in touch shortly.
                  </div>
                }

              </div>
            </form>

            <script>
              const form = document.querySelector("form");

              const contactSelect = document.getElementById("contactMethod");
              const phoneField = document.getElementById("phoneField");
              const emailField = document.getElementById("emailField");

              const nameInput = document.getElementById("nameInput");
              const messageInput = document.getElementById("messageInput");

              const emailInput = document.getElementById("emailInput");
              const phoneInput = document.getElementById("phoneInput");

              const submitBtn = document.getElementById("submitBtn");
              const btnText = document.getElementById("btnText");
              const spinner = document.getElementById("spinner");

              function applyRequirements() {
                const method = contactSelect.value;
                const isEmail = method === "Email";
                const isPhoneOrText = (method === "Phone call" || method === "Text");
                const isAny = method === "Any";

                nameInput.required = true;
                messageInput.required = true;

                if (isAny) {
                  emailField.classList.remove("d-none");
                  phoneField.classList.remove("d-none");

                  emailInput.disabled = false;
                  phoneInput.disabled = false;

                  emailInput.required = true;
                  phoneInput.required = true;
                  return;
                }

                if (isEmail) {
                  emailField.classList.remove("d-none");
                  phoneField.classList.add("d-none");

                  emailInput.disabled = false;
                  emailInput.required = true;

                  phoneInput.disabled = true;
                  phoneInput.required = false;
                  phoneInput.removeAttribute("required");
                  return;
                }

                if (isPhoneOrText) {
                  emailField.classList.add("d-none");
                  phoneField.classList.remove("d-none");

                  emailInput.disabled = true;
                  emailInput.required = false;
                  emailInput.removeAttribute("required");

                  phoneInput.disabled = false;
                  phoneInput.required = true;
                  return;
                }
              }

              contactSelect.addEventListener("change", applyRequirements);
              applyRequirements();

              form.addEventListener("submit", function () {
                applyRequirements();

                if (!form.checkValidity()) return;

                submitBtn.disabled = true;
                submitBtn.classList.add("opacity-75");

                btnText.innerText = "Sending...";
                spinner.classList.remove("d-none");
              });
            </script>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>