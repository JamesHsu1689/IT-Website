@page
@model ITWebsite.Pages.ContactModel
@{
}


<section class="py-5">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-6">
        <h1 class="fw-bold section-title mb-2">Contact</h1>
        <p class="text-secondary mb-4">
          Tell me what you need help with. I’ll reply with next steps and an estimate.
        </p>

        <div class="d-flex gap-3 mb-3">
          <div class="icon-badge"><i class="bi bi-clock fs-5"></i></div>
          <div>
            <div class="fw-semibold">Availability</div>
            <div class="text-secondary">Typically evenings & weekends</div>
          </div>
        </div>

        <div class="d-flex gap-3 mb-3">
          <div class="icon-badge"><i class="bi bi-geo-alt fs-5"></i></div>
          <div>
            <div class="fw-semibold">Service area</div>
            <div class="text-secondary">Remote + on-site anywhere in Calgary</div>
          </div>
        </div>

        <div class="d-flex gap-3">
          <div class="icon-badge"><i class="bi bi-shield-check fs-5"></i></div>
          <div>
            <div class="fw-semibold">What to expect</div>
            <div class="text-secondary">Clear communication, documentation, and honest pricing</div>
          </div>
        </div>
      </div>

      <div class="col-lg-6">
        <div class="card hover-lift">
          <div class="card-body p-4">
            <h4 class="fw-semibold mb-3">Let's get connected</h4>
            
            <form method="post" asp-antiforgery="true">
            
              <input type="hidden" asp-for="FormTimeToken" />

              <!-- Honeypot: real users never see/fill this -->
              <div class="d-none">
                  <label>Website</label>
                  <input class="form-control" name="Website" autocomplete="off" tabindex="-1" />
              </div>


                <div class="row g-3">

                    <div class="col-md-6">                    
                      <label class="form-label">Name</label>
                      <input class="form-control" name="Name" id="nameInput" placeholder="Your name" />
                      <span class="text-danger" asp-validation-for="Name"></span>
                    </div>

                    <div class="col-md-6" id="emailField">
                      <label class="form-label">Email</label>
                      <input class="form-control" name="Email" id="emailInput" placeholder="example@email.com" />
                      <span class="text-danger" asp-validation-for="Email"></span>
                    </div>

                    <div class="col-12 d-none" id="phoneField">
                        <label class="form-label">Phone Number</label>
                        <input class="form-control" 
                              name="PhoneNumber" 
                              id="phoneInput"
                              placeholder="(403) 123-4567" />
                        <span class="text-danger" asp-validation-for="PhoneNumber"></span>
                    </div>

                    <div class="col-12">
                      <label class="form-label">Your message</label>
                      <textarea class="form-control" name="Message" id="messageInput" rows="5"></textarea>
                      <span class="text-danger" asp-validation-for="Message"></span>
                    </div>

                    <div class="col-12">
                      <label class="form-label">Preferred contact method</label>
                      <select class="form-select" name="ContactMethod" id="contactMethod">                          
                          <option value="Email">Email</option>
                          <option value="Phone call">Phone call</option>
                          <option value="Text">Text</option>          
                          <option value="Any">Any</option>             
                      </select>
                      <span class="text-danger" asp-validation-for="ContactMethod"></span>
                    </div>

                    <div class="col-12 d-grid">
                    <button type="submit" 
                            id="submitBtn"
                            class="btn btn-primary btn-lg">
                        <span id="btnText">Submit</span>
                        <span id="spinner" class="spinner-border spinner-border-sm ms-2 d-none"></span>
                    </button>
                    </div>

                    <div asp-validation-summary="All" class="text-danger"></div>

                    @if (Model.Sent)
                    {
                    <div class="alert alert-success mt-3">
                        Your request has been sent. We’ll be in touch shortly.
                    </div>
                    }

                </div>
                </form>

                <script>
                  const form = document.querySelector("form");

                  const contactSelect = document.getElementById("contactMethod");
                  const phoneField = document.getElementById("phoneField");
                  const emailField = document.getElementById("emailField");

                  const nameInput = document.getElementById("nameInput");
                  const messageInput = document.getElementById("messageInput");

                  const emailInput = document.getElementById("emailInput");
                  const phoneInput = document.getElementById("phoneInput");

                  const submitBtn = document.getElementById("submitBtn");
                  const btnText = document.getElementById("btnText");
                  const spinner = document.getElementById("spinner");

                  function applyRequirements() {
                    const method = contactSelect.value;
                    const isEmail = method === "Email";
                    const isPhoneOrText = (method === "Phone call" || method === "Text");
                    const isAny = method === "Any";

                    nameInput.required = true;
                    messageInput.required = true;

                    if (isAny) {
                      emailField.classList.remove("d-none");
                      phoneField.classList.remove("d-none");

                      emailInput.disabled = false;
                      phoneInput.disabled = false;

                      emailInput.required = true;
                      phoneInput.required = true;
                      return;
                    }

                    if (isEmail) {
                      emailField.classList.remove("d-none");
                      phoneField.classList.add("d-none");

                      emailInput.disabled = false;
                      emailInput.required = true;

                      phoneInput.disabled = true;
                      phoneInput.required = false;
                      phoneInput.removeAttribute("required");
                      return;
                    }

                    if (isPhoneOrText) {
                      emailField.classList.add("d-none");
                      phoneField.classList.remove("d-none");

                      emailInput.disabled = true;
                      emailInput.required = false;
                      emailInput.removeAttribute("required");

                      phoneInput.disabled = false;
                      phoneInput.required = true;
                      return;
                    }
                  }

                  contactSelect.addEventListener("change", applyRequirements);
                  applyRequirements();

                  form.addEventListener("submit", function () {

                    // Re-apply rules before validation
                    applyRequirements();

                    // If browser validation fails, do NOT show spinner
                    if (!form.checkValidity()) return;

                    // Disable button + show spinner
                    submitBtn.disabled = true;
                    submitBtn.classList.add("opacity-75");

                    btnText.innerText = "Sending...";
                    spinner.classList.remove("d-none");
                  });
                </script>

          </div>
        </div>
      </div>
    </div>
  </div>
</section>